{% extends "layout.html" %}

{% block title %}BugFist | Dashboard{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-xl-8 px-5 content-body">

{% with messages = get_flashed_messages() %}
  {% if messages %}
    {% for msg in messages %}
      <div class="alert alert-secondary" role="alert">
        {{msg}}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

    <h2>Welcome back, {{session["username"]}}!</h2>
    <p>Soon this will be a nice dashboard where standard users can view the status of their previous bug reports. The admins/contributors will be able to view all reports on this page. There will also be a prominent link to submit a new bug. Administrators will also be able to access this page, and submit bugs like a standard user. Administration of users will take place on a separate page.</p>
    <hr>

    <h3>Open Tickets: {{ openCount }}</h3>
    <div class="ticket-container">
      <table class="ticket-table">
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Category</th>
          <th>Raise User</th>
          <th>Priority</th>
        </tr>

        {% for ticket in openTickets %}
          <tr>
            <td><a href="{{ url_for('ticket_page', ticketId=ticket['id']) }}">{{ ticket['id'] }}</a></td>
            <td><a href="{{ url_for('ticket_page', ticketId=ticket['id']) }}">{{ ticket['title'] }}</a></td>

            {% if ticket.category == None %}
              <td><a href="{{ url_for('ticket_page', ticketId=ticket['id']) }}">N/A</a></td>
            {% else %}
              <td><a href="{{ url_for('ticket_page', ticketId=ticket['id']) }}">{{ ticket.category['name'] }}</a></td>
            {% endif %}

            <td><a href="{{ url_for('ticket_page', ticketId=ticket['id']) }}">{{ ticket.raise_user['username'] }}</a></td>

            {% if ticket['priority'] == 3 %}
              <td><a href="{{ url_for('ticket_page', ticketId=ticket['id']) }}"><span style="color:green">Low</span></a></td>
            {% elif ticket['priority'] == 2 %}
              <td><a href="{{ url_for('ticket_page', ticketId=ticket['id']) }}"><span style="color:darkorange">Medium</span></a></td>
            {% elif ticket['priority'] == 1 %}
              <td><a href="{{ url_for('ticket_page', ticketId=ticket['id']) }}"><span style="color:red">High</span></a></td>
            {% else %}
              <td><a href="{{ url_for('ticket_page', ticketId=ticket['id']) }}">N/A</a></td>
            {% endif %}

          </tr>
        {% endfor %}
      </table>

      {% if openTickets == [] %}
      <p style="text-align:center; padding:40px; color:#888; font-size: 1.4rem;">No Open Tickets</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
